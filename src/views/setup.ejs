<%- include("partials/header", { title: "Setup" }) %>

<h1><%= tournament.name %> Setup</h1>
<p>
  <a href="/t/<%= tournament.id %>/dashboard">Dashboard</a> |
  <a href="/t/<%= tournament.id %>/standings">Standings</a>
</p>

<div class="card">
  <h2>Setup Checklist</h2>
  <ol>
    <li>Add players (must be multiple of 4).</li>
    <li>Create courses and enter all holes (front/back).</li>
    <li>Create days and assign courses.</li>
    <li>Auto-generate pairings, then edit if needed.</li>
  </ol>
</div>

<div class="row">
  <div class="card">
    <h2>Players (<%= playerCount %>)</h2>
    <% if (!rosterOk) { %>
      <p class="danger">Roster must be a multiple of 4.</p>
    <% } else { %>
      <span class="badge">Roster OK</span>
    <% } %>

    <table class="players-table">
      <thead>
        <tr><th>Name</th><th>Index</th><th>Category</th><th>Actions</th></tr>
      </thead>
      <tbody>
        <% tournament.players.forEach((player) => { %>
          <tr>
            <td><%= player.name %></td>
            <td><%= player.index %></td>
            <td><%= player.categoryKey %></td>
            <td>-</td>
          </tr>
          <tr>
            <form method="post" action="/t/<%= tournament.id %>/players/<%= player.id %>">
              <td><input name="name" value="<%= player.name %>" /></td>
              <td><input name="index" type="number" step="0.1" value="<%= player.index %>" /></td>
              <td>
                <select name="categoryKey">
                  <% categories.forEach((category) => { %>
                    <option value="<%= category %>" <%= category === player.categoryKey ? 'selected' : '' %>><%= category %></option>
                  <% }) %>
                </select>
              </td>
              <td><button type="submit">Save</button></td>
            </form>
          </tr>
        <% }) %>
      </tbody>
      <tfoot>
        <tr>
          <form method="post" action="/t/<%= tournament.id %>/players">
            <td><input name="name" placeholder="Name" /></td>
            <td><input name="index" type="number" step="0.1" placeholder="Index" /></td>
            <td>
              <select name="categoryKey">
                <% categories.forEach((category) => { %>
                  <option value="<%= category %>"><%= category %></option>
                <% }) %>
              </select>
            </td>
            <td><button type="submit">Add</button></td>
          </form>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="card">
    <h2>Courses</h2>
    <table>
      <thead>
        <tr><th>Name</th><th>Tee</th><th>Slope</th><th>Rating</th><th>Yardage</th><th>Par</th><th>Holes</th></tr>
      </thead>
      <tbody>
        <% tournament.courses.forEach((course) => { %>
          <tr>
            <td><%= course.name %></td>
            <td><%= course.tee ?? '-' %></td>
            <td><%= course.slope ?? '-' %></td>
            <td><%= course.rating ?? '-' %></td>
            <td><%= course.yardage ?? '-' %></td>
            <td><%= course.parTotal ?? '-' %></td>
            <td><%= course.holes.length %></td>
          </tr>
          <tr>
            <td colspan="7">
              <form method="post" action="/t/<%= tournament.id %>/courses/<%= course.id %>">
                <input name="name" value="<%= course.name %>" />
                <input name="type" value="<%= course.type ?? '' %>" placeholder="Type" />
                <input name="tee" value="<%= course.tee ?? '' %>" placeholder="Tee" />
                <input name="yardage" type="number" value="<%= course.yardage ?? '' %>" placeholder="Yardage" />
                <input name="slope" type="number" value="<%= course.slope ?? '' %>" placeholder="Slope" />
                <input name="rating" type="number" step="0.1" value="<%= course.rating ?? '' %>" placeholder="Rating" />
                <input name="parTotal" type="number" value="<%= course.parTotal ?? '' %>" placeholder="Par total" />
                <button type="submit">Save</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <form method="post" action="/t/<%= tournament.id %>/courses">
      <input name="name" placeholder="Course name" />
      <input name="type" placeholder="Type (18/par3-9)" />
      <input name="tee" placeholder="Tee" />
      <input name="yardage" type="number" placeholder="Yardage" />
      <input name="slope" type="number" placeholder="Slope" />
      <input name="rating" type="number" step="0.1" placeholder="Rating" />
      <input name="parTotal" type="number" placeholder="Par total" />
      <button type="submit">Add Course</button>
    </form>

    <h3>Add/Update Hole</h3>
    <form method="post" action="/t/<%= tournament.id %>/courses/<%= tournament.courses[0]?.id ?? '' %>/holes">
      <select name="courseId" onchange="this.form.action='/t/<%= tournament.id %>/courses/' + this.value + '/holes'">
        <% tournament.courses.forEach((course) => { %>
          <option value="<%= course.id %>"><%= course.name %></option>
        <% }) %>
      </select>
      <select name="segment">
        <option value="front">Front</option>
        <option value="back">Back</option>
      </select>
      <input name="holeNumber" type="number" placeholder="Hole" />
      <input name="par" type="number" placeholder="Par" />
      <input name="strokeIndex" type="number" placeholder="Stroke Index" />
      <button type="submit">Upsert Hole</button>
    </form>
  </div>
</div>

<div class="card">
  <h2>Days</h2>
  <p>Create day entries only after roster is a multiple of 4.</p>
  <p>
    <% tournament.days.forEach((day, index) => { %>
      <a href="/t/<%= tournament.id %>/day/<%= day.id %>/scores">Scorecard: <%= day.name %></a><%= index < tournament.days.length - 1 ? ' | ' : '' %>
    <% }) %>
  </p>
  <table class="days-table">
    <thead>
      <tr><th>Name</th><th>Course</th><th>Match</th><th>Stroke Rule</th><th>Scramble</th><th>Actions</th></tr>
    </thead>
    <tbody>
      <% tournament.days.forEach((day) => { %>
        <tr>
          <td><%= day.name %></td>
          <td><%= day.course.name %></td>
          <td><%= day.isMatchPlay ? 'Yes' : 'No' %></td>
          <td><%= day.strokePlayRule %></td>
          <td><%= day.isScramble ? 'Yes' : 'No' %></td>
          <td>
            <a href="/t/<%= tournament.id %>/day/<%= day.id %>/scores">Scores</a> |
            <a href="/t/<%= tournament.id %>/day/<%= day.id %>/scramble">Scramble</a>
            <% if (day.isMatchPlay) { %>
              | <form style="display:inline" method="post" action="/t/<%= tournament.id %>/days/<%= day.id %>/auto-pairings">
                  <button type="submit">Auto-generate Pairings</button>
                </form>
            <% } %>
          </td>
        </tr>
        <tr>
          <td colspan="6">
            <form method="post" action="/t/<%= tournament.id %>/days/<%= day.id %>/side-contests">
              <strong>Side Contest</strong>
              <select name="type">
                <option value="LongDrive">Long Drive</option>
                <option value="ClosestToPin">Closest To Pin</option>
                <option value="LongPutt">Long Putt</option>
                <option value="SecretSnowman">Secret Snowman</option>
              </select>
              <select name="holeNumber">
                <% for (let i = 1; i <= 18; i += 1) { %>
                  <option value="<%= i %>"><%= i %></option>
                <% } %>
              </select>
              <button type="submit">Upsert</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>

  <form method="post" action="/t/<%= tournament.id %>/days">
    <select name="dayNumber">
      <% for (let i = 1; i <= 4; i += 1) { %>
        <option value="<%= i %>">Day <%= i %></option>
      <% } %>
    </select>
    <select name="roundSuffix">
      <option value="">Round</option>
      <option value="A">Round A</option>
      <option value="B">Round B</option>
    </select>
    <input name="name" placeholder="Custom day name (optional)" />
    <select name="courseId">
      <% tournament.courses.forEach((course) => { %>
        <option value="<%= course.id %>"><%= course.name %></option>
      <% }) %>
    </select>
    <label><input type="checkbox" name="isMatchPlay" /> Match Play</label>
    <select name="isScramble">
      <option value="off">Scramble: No</option>
      <option value="on">Scramble: Yes</option>
    </select>
    <select name="strokePlayRule">
      <option value="none">No Stroke</option>
      <option value="strokePlayTop8Fixed">Stroke Top 8 Fixed</option>
      <option value="strokePlayFull">Stroke Full</option>
    </select>
    <button type="submit">Add Day</button>
  </form>
</div>

<%- include("partials/footer") %>
